{% from 'macros/icon.njk' import icon with context %}

{% set buttonLabel =  'See details' if event.isPastEvent else "See who's joining" %}

<enhanced-event-card>
  <article id="{{ event.id }}"
           class="event-card pad-400 lg:pad-500 no-js"
           tabindex="0"
           show-details="">
    <div class="display-flex">
      <figure class="event-card__desktop-image gap-right-500 flex-shrink-none">
        {% Img src=event.image, alt=event.title, width=400, height=400 %}
      </figure>

      <div class="event-card__overview display-flex direction-column justify-content-between">
        <div>
          <div class="event-card__title">
            <figure class="event-card__image gap-right-200 flex-shrink-none">
              {% Img src=event.image, alt=event.title, width=400, height=400 %}
            </figure>

            <a href="{{ event.externalUrl }}"
               class="decoration-none"
               target="_blank">
              {{ event.title }}
            </a>
          </div>

          <p>
            {{ event.summary }}
          </p>

          <div class="event-card__meta display-flex gap-bottom-400">
            <p class="display-flex align-center gap-right-500">
              {{ icon('pin') }}
              {{ event.location }}
            </p>

            <p class="display-flex align-center">
              {{ icon('calendar') }}
              {{ helpers.formatDateShort(event.date, locale) }}
            </p>
          </div>
        </div>

        <button class="material-button button-filled button-round">
          {{ buttonLabel }}
        </button>
      </div>
    </div>
    <div class="event-card__details gap-top-400 grid-cols-1 grid-gap-400 lg:grid-cols-2">
      {% for session in event.sessions %}
        {% if session.type === 'speaker' %}
          {% set alt = session.speaker.title or session.title %}
          {% set sessionImage = session.speaker.image %}
          {% set sessionTitle = session.speaker.title %}

          <article class="event-session-card bg-bg">
            <a
              href="{{ externalUrl }}"
              target="_blank"
              rel="noopener noreferrer"
              class="event-card__title decoration-none gap-bottom-300 display-flex align-center justify-content-between"
            >
              <span class="display-flex align-center">
                {% Img
                  src=sessionImage,
                  alt=alt,
                  width=40,
                  height=40,
                  class='flex-shrink-none height-600 width-600 rounded-full gap-right-300' %}

                {{ sessionTitle }}
              </span>

              {{ icon('launch') }}
            </a>

            <p class="event-card__sub-title gap-bottom-200">
              Talk title
            </p>

            <p class="gap-bottom-300">{{ session.title }}</p>

            {% if session.description|length %}
              <p class="event-card__sub-title gap-bottom-200">
                Details
              </p>

              <div class="gap-bottom-300">
                <p>
                  <truncate-text maxLength="100">{{ session.description }}</truncate-text>
                </p>
              </div>
            {% endif %}

            {% if session.slidesUrl|length or session.videoUrl|length %}
              <div class="event-card__sub-title gap-bottom-100">Link to Talk</div>

              <div class="event-card__links display-flex gap-bottom-300">
                {% if session.slidesUrl|length %}
                  <a
                    href="{{ session.slidesUrl }}"
                    target="_blank"
                    rel="noopener noreferrer"
                    class="display-flex align-center gap-right-300 decoration-none"
                  >
                    {{ icon('slides') }} Slides
                  </a>
                {% endif %}

                {% if session.videoUrl|length %}
                  <a
                    href="{{ session.videoUrl }}"
                    target="_blank"
                    rel="noopener noreferrer"
                    class="display-flex align-center decoration-none"
                  >
                    {{ icon('video') }} Video
                  </a>
                {% endif %}
              </div>
            {% endif %}

            {% for topic in session.topics %}
              {% include 'partials/event-card-tag.njk' %}
            {% endfor %}
          </article>
        {% endif %}
      {% endfor %}

      {% for session in event.sessions %}
        {% if session.type === 'participant' %}
          {% set sessionTitle = session.participants[0].title if session.participants.length === 1 else 'Multiple participants' %}
          {% set sessionImage = session.participants[0].image if session.participants.length === 1 else site.chromeImg %}
          {% set alt = session.speaker.title or session.title %}

          <article class="event-session-card bg-bg">
            <a
              href="{{ externalUrl }}"
              target="_blank"
              rel="noopener noreferrer"
              class="event-card__title decoration-none gap-bottom-300 display-flex align-center justify-content-between"
            >
              <span class="display-flex align-center">
                {% Img
                  src=sessionImage,
                  alt=alt,
                  width=40,
                  height=40,
                  class='flex-shrink-none height-600 width-600 rounded-full gap-right-300' %}

                {{ sessionTitle }}
              </span>

              {{ icon('launch') }}
            </a>

            <p class="event-card__sub-title gap-bottom-200">
              Participant details
            </p>

            {% if session.description|length %}
              <div class="gap-bottom-300">
                <p>
                  <truncate-text maxLength="100">{{ session.description }}</truncate-text>
                </p>
              </div>
            {% endif %}

            {% if session.participants|length %}
              <p class="event-card__sub-title gap-bottom-200">
                Participants
              </p>
              <p class="gap-bottom-300">
                {% if participant.twitter %}
                  <a
                    href="https://twitter.com/{{ participant.twitter }}"
                    target="_blank"
                    rel="noopener noreferrer"
                  >{{ participant.title }}</a>
                {% elseif participant.linkedin %}
                  <a
                    href="{{ participant.linkedin }}"
                    target="_blank"
                    rel="noopener noreferrer"
                  >{{ participant.title }}</a>
                {% else %}
                  {{ participant.title }}
                {% endif %}
              </p>
            {% endif %}

            {% for topic in session.topics %}
              {% include 'partials/event-card-tag.njk' %}
            {% endfor %}
          </article>
        {% endif %}
      {% endfor %}
    </div>
  </article>
</enhanced-event-card>
